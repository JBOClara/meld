name: CI
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build:
    runs-on: macos-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      - name: Check System
        run: |
          which brew || echo "brew not found"
          which git || echo "git not found"

      - name: Setup Homebrew & Various Tools
        run: |
          #/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          brew install git ccache optipng imagemagick librsvg
          #brew install sassc python3
          #brew install caskformula/caskformula/inkscape

      - name: Setup JHbuild
        run: |
          export LC_ALL=en_US.UTF-8
          export LANG=en_US.UTF-8
          export MACOSX_DEPLOYMENT_TARGET=10.13
          export PATH=$HOME/.new_local/bin:$HOME/gtk/inst/bin:$PATH
          /bin/bash -c "$(curl -fsSL https://gitlab.gnome.org/GNOME/gtk-osx/raw/master/gtk-osx-setup.sh)"
          $HOME/.new_local/share/pyenv/versions/3.10.0/bin/python3.10 -m pip install --upgrade pip
          (cd meld/osx && ln -sf ${PWD}/jhbuildrc-custom ${HOME}/.config/jhbuildrc-custom)

      - name: Build Environment
        run: |
          source ./osx/build_env.sh

      
